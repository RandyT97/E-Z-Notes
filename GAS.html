<!DOCTYPE html>
<html>
<body>
  <p>Studyex!</p>

  <!--Add buttons to initiate auth sequence and sign out-->
  <button id="authorize-button" style="display: none;">Authorize</button>
  <button id="signout-button" style="display: none;">Sign Out</button>

  <pre id="content"></pre>

  <script type="text/javascript">
    // Client ID and API key from the Developer Console
    var CLIENT_ID = '<SEEDEVELOPERCONSOLE>';
    var API_KEY = '<SEEDEVELOPERCONSOLE>';

    // Array of API discovery doc URLs for APIs used by the quickstart
    var DISCOVERY_DOCS = ["https://script.googleapis.com/$discovery/rest?version=v1"];

    // If you ever doubt your scopes, just get all of them -badprogrammingtips
    var SCOPES = 'https://apps-apis.google.com/a/feeds https://apps-apis.google.com/a/feeds/alias/ https://apps-apis.google.com/a/feeds/groups/ https://mail.google.com/ https://sites.google.com/feeds https://www.google.com/calendar/feeds https://www.google.com/m8/feeds https://www.googleapis.com/auth/admin.directory.group https://www.googleapis.com/auth/admin.directory.user https://www.googleapis.com/auth/documents https://www.googleapis.com/auth/documents.currentonly https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/dynamiccreatives https://www.googleapis.com/auth/forms https://www.googleapis.com/auth/forms.currentonly https://www.googleapis.com/auth/groups https://www.googleapis.com/auth/script.cpanel https://www.googleapis.com/auth/script.external_request https://www.googleapis.com/auth/script.scriptapp https://www.googleapis.com/auth/script.send_mail https://www.googleapis.com/auth/script.storage https://www.googleapis.com/auth/script.webapp.deploy https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/spreadsheets.currentonly https://www.googleapis.com/auth/sqlservice https://www.googleapis.com/auth/userinfo.email';

    var authorizeButton = document.getElementById('authorize-button');
    var signoutButton = document.getElementById('signout-button');
    var scriptId = 
      '1NLhUTcbWlqWH1rD5Dlq8ffXLFDOf9uRrSET2wIZmDKmWTYoPXK29hc1I';

    var documentId;

    /**
     *  On load, called to load the auth2 library and API client library.
     */
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    /**
     *  Initializes the API client library and sets up sign-in state
     *  listeners.
     */
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      });
    }

    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';

        //TEST FUNCTION
        callScriptFunction();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
      }
    }

    //Appends onto a new line in the file given the id of the document and
    //String wanted
    function appendToDoc(id, text) {
      gapi.client.script.scripts.run({
        'scriptId': scriptId,
        'resource': {
        'function': 'appendText',
        'devMode': true,
        'parameters': [
          id,
          text
          ]
        }     
      }).then(function(resp) {
        return;
      });
    }

    function createDoc(name) {
      gapi.client.script.scripts.run({
        'scriptId': scriptId,
        'resource': {
        'function': 'newDocument',
        'devMode': true,
        'parameters': [
          name
          ]
        }     
      }).then(function(resp) {
        return;
      });
    }

    // Example DOC ID 1Y9vt43piRGpcmPAgxfMTnPygx2QKWotoyTHCAMBhFfc
    function callScriptFunction() {
      appendToDoc('1Y9vt43piRGpcmPAgxfMTnPygx2QKWotoyTHCAMBhFfc', "EJ'S NEAT O STAT OF THE NIGHT");
      createDoc("TestFILES");
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }

  </script>

  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</body>
</html>